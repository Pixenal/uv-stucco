cmake_minimum_required(VERSION 3.2)
cmake_policy(SET CMP0063 NEW)
project(RUVM)
if(CMAKE_BUILD_TYPE MATCHES DEBUG)
	message("Debug build -- using gcc")
	set(CMAKE_C_COMPILER gcc)
	set(CMAKE_C_FLAGS "-g -O0 -DEBUG -pthread -Wshadow -Wunused -Wunused-parameter -D PLATFORM_LINUX -fPIC")
endif(CMAKE_BUILD_TYPE MATCHES DEBUG)
if(CMAKE_BUILD_TYPE MATCHES RELEASE)
	message("Release build -- using clang")
	set(CMAKE_C_COMPILER clang)
	set(CMAKE_C_FLAGS_RELEASE "-ftree-vectorize -mavx2 -finline-functions -flto -O2 -pthread -D PLATFORM_LINUX -fPIC")
endif(CMAKE_BUILD_TYPE MATCHES RELEASE)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)
add_library(RUVM STATIC Src/Allocator.c Src/BoundaryFaces.c Src/Io.c Src/MapToMesh.c Src/PlatformLinux.c Src/QuadTree.c Src/RUVM.c Src/ThreadPool.c Src/Types.c Src/EnclosingCells)
#set_property(TARGET RUVM PROPERTY C_VISIBILITY_PRESET hidden)
#set_property(TARGET RUVM PROPERTY C_VISIBILITY_INLINES_HIDDEN ON)
target_include_directories(RUVM PUBLIC Include)
target_include_directories(RUVM PRIVATE Src)
find_package(ZLIB REQUIRED)
target_link_libraries(RUVM PRIVATE ${ZLIB_LIBRARIES} ${ZLIB_DEPENDENCIES})
